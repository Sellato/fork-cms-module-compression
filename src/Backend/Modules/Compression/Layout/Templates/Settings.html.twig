{% extends '/Layout/Templates/base.html.twig' %}

{% block content %}
    <div class="row fork-module-messages">
        <div class="col-md-12">

            {% if apiKey is empty or folders is empty %}
                <div class="alert alert-warning" role="alert">
                    <p><strong><span class="fa fa-exclamation-triangle"></span> {{ 'msg.ConfigurationError'|trans }}</strong></p>
                    <ul class="pb0">
                        {% if not apiKey %}<li>{{ 'err.NoApiKey'|trans }}</li>{% endif %}
                        {% if apiKey and folders is empty %}<li>{{ 'err.NoFoldersSet'|trans}}</li>{% endif %}
                    </ul>
                </div>
            {% endif %}

        </div>
    </div>

    {# Step1 Wizard: ask for API key #}
    {% if not apiKey %}
        {% form settings %}
            <div class="row fork-module-content">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                {{ 'lbl.TinyPNGLink'|trans|capitalize }}
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                {{ 'msg.LinkTinyPNGAccount'|trans|raw }}
                            </div>

                            <div class="form-group">
                                <label for="apiKey" class="control-label">{{ 'lbl.ApiKey'|trans|capitalize }}</label>
                                {% form_field_error key %} {% form_field key %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row fork-module-actions">
                <div class="col-md-12">
                    <div class="btn-toolbar">
                        <div class="btn-group pull-right" role="group">
                            <button id="authenticate" type="submit" name="authenticate" class="btn btn-primary">
                                <span class="fa fa-link"></span>{{ 'lbl.AuthenticateWithTinyPNG'|trans|capitalize }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endform %}
    {% endif %}

    {% if apiKey %}
        {% form compression %}
            <div class="row fork-module-content">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                {{ 'lbl.FoldersToCompress'|trans|capitalize }}
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div class="form-group jstree-wrapper">
                                <div class="js-tree-folders">
                                    {{ directoryTree|raw }}
                                </div>
                                {% form_field dummy_folders %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row fork-module-content">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                {{ 'lbl.Console'|trans|capitalize }}
                            </h3>
                        </div>

                        <div class="panel-body">
                            <div class="form-group">
                                <textarea name="rss_description" cols="62" rows="10" readonly class="textarea js-console" style="width: 100%; "></textarea>
                                <span class="help-block">{{ 'msg.Console'|trans }}</span>
                            </div>

                            <div class="btn-toolbar">
                                <div class="btn-group pull-left" role="group">
                                    <button type="submit" name="process" class="btn btn-info js-btn-console">
                                        <span class="fa fa-cog"></span>{{ 'lbl.Execute'|trans|capitalize }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row fork-module-actions">
                <div class="col-md-12">
                    <div class="btn-toolbar">
                        <div class="btn-group pull-left" role="group">
                            <a href="{{ geturl('settings') }}&amp;remove=api_key" data-message-id="confirmDeleteAccountLink" class="askConfirmation btn btn-danger btn-sm">
                                <span class="fa fa-chain-broken"></span>{{ 'msg.RemoveAccountLink'|trans }}
                            </a>
                        </div>
                        <div class="btn-group pull-right" role="group">
                            <button id="save" type="submit" name="save" class="btn btn-primary">
                                <span class="fa fa-floppy-o"></span>{{ 'lbl.Save'|trans|capitalize }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endform %}
    {% endif %}
{% endblock %}

	{#<div class="box">#}
		{#<div class="heading">#}
			{#<h3>{$lblConsole|ucfirst}</h3>#}
		{#</div>#}
		{#<div class="options">#}
			{#<label for="console">{$lblConsole|ucfirst}</label>#}
			{#<textarea id="console" name="rss_description" cols="62" rows="10" readonly class="textarea" style="width: 100%; "></textarea>#}
			{#<span class="helpTxt">{$msgConsole}</span>#}
		{#</div>#}
		{#<div class="options">#}
			{#<div class="buttonHolder">#}
				{#<a id="console-btn" class="button mainButton" href="#">{$lblExecute|ucfirst}</a>#}
			{#</div>#}
		{#</div>#}
	{#</div>#}

	{#<div class="fullwidthOptions">#}
		{#<div class="buttonHolderLeft">#}
			{#<a href="{$var|geturl:'settings'}&amp;remove=api_key" data-message-id="confirmDeleteAccountLink" class="askConfirmation button inputButton"><span>{$msgRemoveAccountLink}</span></a>#}
		{#</div>#}
		{#<div class="buttonHolderRight">#}
			{#<input id="save" class="inputButton button mainButton" type="submit" name="save" value="{$lblSave|ucfirst}" />#}
		{#</div>#}
	{#</div>#}

	{#<div id="confirmDeleteAccountLink" title="{$lblDelete|ucfirst}?" style="display: none;">#}
		{#<p>#}
			{#{$msgConfirmDeleteLinkAccount}#}
		{#</p>#}
	{#</div>#}
{#{/form:compressionSettings}#}
{#{/option:EverythingIsPresent}#}
